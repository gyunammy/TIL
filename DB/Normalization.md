# 정규화

DB에는 중복된 데이터를 허용하지 않도록 테이블과 데이터를 분리하는 과정을 정규화(Normalization) 라고 하며 정규화를 함으로써 데이터의 무결성(Integrity)를 
유지할 수 있고, 중복된 데이터가 없어지므로 DB의 용량 또한 줄일 수 있다.

정규화과정은 어려 단계로 나누어져 있다.

<br>



### 1. 제 1 정규화

제 1정규화란 테이블의 컬럼이 원자값, 즉 하나의 값만을 갖도록 테이블을 분해하는 과정을 말한다.

<br>

<정규화 전>
|이름|생년월일|직업|
|----|--------|-----|
|홍길동|19940329|공무원,뮤지션|

<br>
        
<정규화 후>
|이름|생년월일|직업|
|----|--------|-----|
|홍길동|19940329|공무원|
|홍길동|19940329|뮤지션|


<br>



### 2. 제 2 정규화

제 2 정규화란 제 1 정규화를 진행한 테이블에 대해 완전 함수 종속을 만족하도록 테이블을 분해하는 것을 말한다. 완전 함수 종속이란, 모든 일반속성이 모든 주식별자에 종속적이라는 의미를 갖는다.

<br>

<정규화 전>
|주문번호|음료코드|주문수량|음료명|
|----|--------|-----|-----|
|202106010010|a1001|2|아메리카노|
|202106010011|b1002|1|카페라떼|
|202106010012|a1001|3|아메리카노|
<br>
        
<정규화 후>
|주문번호|음료코드|주문수량|
|----|--------|-----|
|202106010010|a1001|2|
|202106010011|b1002|1|
|202106010012|a1001|3|

|음료코드|음료명|
|-------|------|
|a1001|아메리카노|
|b1002|카페라떼|


<br>



음료명은 주식별자중 음료코드에만 부분종속적이므로 정규화 과정을 통해 완전 함수 종속을 만족시키게 된다.


<br>



### 3. 제 3 정규화

제 3 정규화란 제 2 정규화를 진행한 테이블에 대해 이행적 종속을 없애도록 테이블을 분해하는 것을 말한다. 쉽게 말해 주 식별자가 아닌 속성간에는 서로 종속될 수 없다.

<br>

<정규화 전>
|학생번호|강좌이름|수강료|
|----|--------|-----|
|501|데이터베이스|20000|
|401|데이터베이스|20000|
|402|스포츠경영학|15000|
|502|자료구조|25000|
<br>
        
<정규화 후>
|학생번호|강좌이름|
|----|--------|
|501|데이터베이스|
|401|데이터베이스|
|402|스포츠경영학|
|502|자료구조|

|강좌이름|수강료|
|--------|-----|
|데이터베이스|20000|
|스포츠경영학|15000|
|자료구조|25000|


<br>



이행적 종속을 제거하는 이유는 특정 학생이 수강강좌를 변경할 경우 db의 데이터에는 강좌 이름만 변경될 뿐, 수강료는 변경되지 않는다.
따라서 유지보수성이 떨어지게 된다.

하지만 테이블을 분리시켜서 이행적 종속을 없애게 되면 수강강좌를 변경할 경우 수강료를 바꿔주지 않아도 되기 때문에 유지보수성이 향상된다.


<br>



### 4. BCNF 정규화

BCNF 정규화란 제 3정규화를 진행한 테이블에 대해 모든 결정자가 후보키가 되도록 테이블을 분해하는 것이다.


<br>



<정규화 전>
|학생번호|특강이름|교수|
|-------|--------|---|
|501|네트워크|김교수|
|401|네트워크|김교수|
|402|인간과 동물|승교수|
|502|창업전략|박교수|
|501|창업전략|홍교수|


<br>



해당 테이블의 기본키는 학생번호와 특강이름이다. 학생번호는 교수를 결정하고, 교수가 특강이름을 결정하고 있는 상황에서 문제는 교수가 특강이름을 결정하는 결정자임에도 후보키가 아니라는 점이다. 따라서 정규화를 통해 교수를 후보키로 만들어주어야 한다.


<br>



<정규화 후>
|학생번호|특강이름|
|-------|--------|
|501|네트워크|
|401|네트워크|
|402|인간과 동물|
|502|창업전략|
|501|창업전략|

<br>


|특강이름|교수|
|-------|----|
|네트워크|김교수|
|인간과 동물|승교수|
|창업전략|박교수|
|창업전략|홍교수|

<br>


# 정규화의 장단점

### 정규화의 장점

* 데이터 변경시 이상현상을 제거할 수 있다.
* 정규화된 데이터베이스 구조에서는 새로운 데이터 형의 추가로 인한 확장시, 구조의 변경을 최소화할 수 있다.
* 데이터베이스와 연동된 응용 프로그램에 최소한의 영향만을 미치게 되어 응용프로그램의 생명을 연장시킨다.

<br>


### 정규화의 단점

* 테이블의 분해로 인해 테이블간 JOIN연산이 많아진다.
* 데이터 요청에 대한 응답시간이 느려질 수도 있다.
* 많은 JOIN으로 인해 성능 저하가 발생할경우 반정규화를 통해 해결할 수 있다.

<br>


# 반정규화

반정규화란 데이터의 조회성능을 향상시키기 위해 데이터의 중복을 허용하거나 데이터를 그룹핑하는 과정이다. 

반정규화를 통해 조회 성능은 향상될 수 있으나, 입력,수정,삭제의 기능은 저하될 수 있으며, 데이터 정합성문제가 발생할 수 있다.

반정규화는 정규화가 끝난 테이블에 한해서 진행된다.

<br>


## 1. 테이블 반정규화

<br>


#### 1-1 테이블 병합

업무 프로세스상 JOIN이 필요한 경우가 많아 테이블을 통합시키는 것이 유리하다고 판단될 경우 테이블 병합이 고려되며 1:M 관계인 테이블 병합시
1에 해당하는 테이블이 속성 개수가 많을경우 중복데이터가 많아지므로 부적절하다.

<br>


#### 1-2 테이블 분할

자주사용되는 속성이 아닌거나 대부분의 인스턴스가 해당 속성값을 null로 갖고 있을경우 테이블 분할이 고려된다.

<br>


#### 1-3 테이블 수평분할

테이블의 인스턴스를 특정 기준으로 별도의 테이블로 분할하는 방법으로 파티셔닝이라고도 한다.   ex) 년도별 주분테이블을 물리적으로 분할.

<br>


## 2. 컬럼 반정규화

<br>


#### 2-1 중복 컬럼 추가

업무 프로세스상 JOIN이 필요한 경우가 많아 컬럼을 추가하는 것이 성능 측면에서 유리할 경우 고려한다.

<br>


#### 2-2 파생 컬럼 추가

프로세스 수행 시 부하가 염려되는 계산값을 미리 컬럼으로 추가하여 보관하는 방식으로 상품의 재고나 프로모션 적용 할인가 등이 이해 해당할 수 있다.

<br>


#### 2-3 이력 테이블 컬럼 추가

대량의 이력 테이블을 조회할 때 속도가 느려질것을 대비하여 조회 기준이 될 것으로 판단되는 컬럼을 미리 추가해 놓는 방식이다. 최신 데이터 여부 등이 이에 해당 할 수 있다.

<br>


## 3. 관계 반정규화

업무 프로세스상 JOIN이 필요한 경우가 많아 중복 관계를 추가하는 것이 성능 측면에서 유리할 경우 고려한다.


<br>



# 참조
[도서] [SQL개발자](https://search.shopping.naver.com/book/catalog/35346148622?query=sql%20%EA%B0%9C%EB%B0%9C%EC%9E%90&NaPm=ct%3Dlgrmson4%7Cci%3D203b4696b70956757404ee28d9d5ae3c9862924a%7Ctr%3Dboksl%7Csn%3D95694%7Chk%3D4047f671f59103e34d67cc936f75d26f2a4e9fb2)

[블로그][https://code-lab1.tistory.com/48](https://code-lab1.tistory.com/48)

[블로그][https://mangkyu.tistory.com/110](https://mangkyu.tistory.com/110)
