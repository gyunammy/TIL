# 교착상태

교착상태란 각각의 프로세스들이 가지고있는 자원들을 서로 기다리고 있는 상황에서는 어떠한 프로세스나 스레드는 실행될 수 없다. 

이러한 상태를 교착상태라고 한다. 즉 사용할 수 없는 자원을 기다리며 무한정 대기상태에 빠져 진행이 멈춰버리는 현상을 교착상태라고 한다.

이러한 교착상태를 해결하기 위해서는 교착 상태가 발생했을 때의 상황을 정확히 표현할 수 있어야 하며, 또한 교착 상태가 일어나는 근본적인 이유를 이해하고 있어야 한다.

교착상태를 표현하기 위한 그래프가 존재하는데 바로 자원할당그래프이다. 자원할당그래프를 통해 교착상태발생 조건파악이 가능하며 어떠한 프로세스가 어떤 자원을 할당받아 사용중인지 확인 가능하고, 어떤 프로세스가 어떤 자원을 기다리고 있는지 확인이 가능하다.

<br>

## 자원할당 그래프

<br>

자원할당 그래프를 표현하는 방법은 다음과 같다.

<br>

### 자원할당 그래프는 프로세스는 원으로, 자원의 종류는 사각형으로 표현한다. 
### 사용할 수 있는 자원의 개수는 자원 사각형 내에 점의 갯수로 표현한다.
### 프로세스가 어떤 자원을 할당 받아 사용중이라면 자원에서 프로세스를 향해 화살표를 표시한다.
### 프로세스가 어떤 자원을 기다리고 있다면 프로세스에서 자원으로 화살표를 표시한다. 

<br>

교착상태가 일어난 그래프의 특징으로는 자원할당 그래프가 원의 형태를 띄고 있다는 점이다. 하지만 원의형태를 띄고 있다하여 반드시 교착상태가 일어나는 것은 아니다.

교착상태가 발생할 조건으로는 다음과 같다.

<br>

### 1. 상호배제 : 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없는 상태
### 2. 점유와 대기 : 자원을 할당 받은 상태에서 다른 자원을  할당 받기를 기다리는 상태
### 3. 비선점 : 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못하는 상태
### 4. 원형 대기 : 프로세스들이 원의 형태로 자원을 대기하는 상태

<br>

위의 네가지 조건중 하나라도 만족하지 않으면 교착상태가 발생하지 않으며 위의 네가지 조건을 모두 만족할 경우에는 교착상태가 발생할 수 있다.

<br>

## 교착 상태 해결 방법

<br>

교착상태 해결방법으로는 세가지 방법이 있다.

<br>

### 1. 교착 상태 예방

<br>

교착 상태 예방은 애초에 교착 상태가 발생하지 않도록 하는 방법을 말하며, 교착상태 발생조건 (상호 배제, 점유와 대기, 비선점, 원형대기)
중 하나를 없애버리는 방법으로 교착상태를 예방한다.

<br>

#### 1-1 상호 배제 조건 없애기

<br>

자원을 하나의 프로세스뿐만 아니라 모두 공유하여 사용할 수 있는 상태로 만듦으로써 상호배제를 없애는 방법은 이론상으로만 가능하며
현실적으로는 불가능하다.

<br>

#### 1-2 점유와 대기 조건 없애기

<br>

자원을 할당받은 상태에서 다른 자원을 기다리는 상태를 점유와 대기라고 하며, 특정 프로세스에 필요한 자원을 모두 할당하거나
아예 할당하지 않도록 하는 방식을 자원을 배분함으로써 점유와 대기를 없앨 수 있다.

이 방법을 통해 교착상태를 예방할 수 있지만 단점도 존재하는데 이는 바로 자원의 활용도를 떨어뜨리는 방법이라는 점이다.

<br>

#### 1-3 비선점 조건 없애기

<br>

비선점 조건은 한프로세스가 다른 프로세스가 사용중인 자원을 빼앗을 수 없다는 조건을 말하며 이는 선점할 수 있는 자원에
한해 효과적이지만 모든 자원이 선점가능한 것이 아니기 때문에 제한적이다.

<br>

#### 1-4 원형 조건 없애기

<br>

원형 대기 조건은 자원할당 그래프에서 원의 형태로 서로의 자원을 기다리는 모습을 원형대기라 하며, 이를 없애기 위해서는
모든 자원에다 번호를 부여하고, 번호의 오름차순대로 자원을 할당하면 된다.

해당 방법의 단점은 모든 자원에 번호를 부여하는 작업이 어려운 작업이라는 점과, 어떠한 자원에 어떤 번호를 붙이느냐에 따라 활용율이 달라진다는 점이 있다.

정리하자만 교착상태 예방 방법은 교착상태가 발생하지 않음은 보장 할 수 있으나 부작용이 따르는 방식이라고 할 수 있다.

<br>

### 2. 교착상태 회피

<br>

교착 상태를 무분별한 자원 할당으로 인해 발생했다고 간주하고, 교착상태가 발생하지 않을 만큼 고려후 자원을 할당하는 방법을 말한다.

교착 상태 회피에 대해 이해하려면 안전 순서열, 안전 상태, 불안전 상태를 이해하고 있어야 한다.

<br>

#### 2-1 안전 순서열

<br>

교착상태 없이 모든 프로세스들에게 안전하게 자원을 할당할 수 있는 순서를 말한다.

<br>

#### 2-2 안전상태

<br>

교착 상태 없이 모든 프로세스가 자원을 할당 받고 종료될 수 있는 상태를 말한다. 즉
안전 순서열이 있는 상태라고 할 수 있다.

<br>

#### 2-3 불안전 상태

<br>

교착상태가 발생할 수 있는 상태를 말한다. 즉 안전 순서열이 없는 상태라고 할 수 있다.

<br>

즉 안전상태는 안전 순서열이 있는 상태를 말하며, 불안전 상태는 안전 순서열이 없는 상태를 말한다.

<br>

### 3. 교착상태 검출 후 회복

<br>

교착상태의 발생을 인정하고 사후에 조치하는 방식으로서 프로세스가 자원을 요구하면 일단 할당하고
교착상태가 검출되면 회복하는 과정을 갖는다.

교착상태를 회복하는 방법으로는 크게 두가지가 있으며 선점을 통한 회복과, 프로세스 강제 종료를 통한 회복이 있다.

선점을 통한 회복은 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식을 말한다.

프로세스 강제 종료를 통한 방법은 모든 프로세스를 강제 종료 시키는 방법과 프로세스 하나씩 종료하며 교착상태가 풀렸는지 확인하는 방법 두가지로 나뉜다. 

교착상태에 놓인 프로세스를 모두 강제종료 하는 방법은 한번에 교착상태를 해결할 수 있지만 작업내용을 잃을 위험이 있다.

교착상태가 해결될 때까지 한 프로세스씩 강제종료하는 방법은 하나씩 프로세스를 종료할때마다 교착상태 해결 여부를 확인해야하기때문에 오버헤드가 늘어나지만 그만큼 작업내용소실을 최소화 하면서 교착상태를 해결 할 수 있다.

<br>

--- 

<br>

### 참조

<br>

[강의] [개발자를 위한 컴퓨터공학 1: 혼자 공부하는 컴퓨터 구조+운영체제](https://www.inflearn.com/course/%ED%98%BC%EC%9E%90-%EA%B3%B5%EB%B6%80%ED%95%98%EB%8A%94-%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B5%AC%EC%A1%B0-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C)
