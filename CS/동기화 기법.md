# 동기화 기법

동기화 기법중에 많이 사용되는 기법은 뮤텍스 락, 세마포, 모니터가 있다.

<br>

## 1, 뮤텍스 락

<br>

상호배제를 위한 동기화 도구라고 할 수 있다. 마치 자물쇠와 같은 역할을 하게 된다. 뮤텍스 락의 특징으로는 단순한 형태로 이루어져 있다는 것이다. 전역 변수 하나와 함수 두개로 이루어져있으며 각각의 역할은 다음과 같다.
 
lock - 프로세스들이 공유하는 전역변수로서 자물쇠 역할을 한다.
acquire - 임계구역을 잠구는 기능을 하는 함수이다.
release - 임계구역의 잠금을 해제하는 기능을 하는 함수이다.

<br>

```
/*---------------------------------------------------------------
만약 임계 구역이 잠겨있다면 임계 구역이 잠겨있는지 반복적으로 확인하고,
임계 구역 잠금이 해제되면 임계구역을 잠군다.
---------------------------------------------------------------*/
acquire(){
    while(lock == true){
        if(lock == false){
            lock = true;
        }
    }
}

/*--------------------------------------
임계 구역 작업이 끝나면 잠금을 해제시킨다.
--------------------------------------*/
release(){
    lock = false;
}
```

<br>

while문으로 무한히 실행하며 임계 구역이 비어있는지 확인하기 때문에 위의 방법은 
바람직하지 않고 이와같은 상황을 바쁜 대기(busy waiting)이라고 한다.

<br>

## 2. 세마포

<br>

세마포는 뮤텍스 락보다 좀더 일반화 된 방식의 동기화 기법이며 공유자원이 여러개 있는 경우에도 적용이 가능하다.

세마포는 임계 구역 앞에서 멈춤신호를 받으면 잠시 대기하다가, 가도 된다는 신호를 받으면 임계 구역에 진입하는 방식을 갖는다.

세마포 역시 단순한 형태로 이루어져 있으며, 전역변수 하나와 함수 두개로 이루어져 있다.

s - 임계 구역에서 진입할 수 있는 프로세스의 개수를 나타내는 전역변수, 즉 사용 가능한 공유자원의 개수를 나타낸다.

wait - 임계 구역에 들어가도 좋은지, 기다려야 할지를 알려주는 기능을 하는 함수이다.
signal - 임계 구역앞에서 기다리는 프로세스에게 통과 신호를 주는 기능을 하는 함수이다.

<br>

```
/*-----------------------------------------------------------------------------
임계 구역에 진입할 수 있는 프로세스 수를 나타내는 변수 s가 0보다 작을때, 즉 
임계 구역에 진입할 수 없다면 반복적으로 확인하며 대기한다.

임계 구역에서 프로세스가 빠져나와 s가 0보다 커질경우 s를 1 감소시킨 후 프로세스가
임계구역에 진입한다.
-----------------------------------------------------------------------------*/
wait(){
    while(s <= 0){
        
    }
    s--;
}

signal(){
    s++;
}
```

<br>

앞서 두 방법을 통해 동기화를 진행할 경우 생기는 문제점 하나가 바로 임계구역앞에서 대기하고 있는 프로세스는 사용할 수 있는지 여부를 계속해서 확인한다는 것이다. 즉 바쁜대기(busy waiting) 현상이 발생한다.

바쁜 대기는 임계구역이 모두 사용중임에도 불구하고 계속 확인하며 cpu의 자원을 사용하게 되므로 바람직하지 않다. 이를 해결하기 위해서는 사용할 수 없는 자원이 없을 경우 대기하고 있는 프로세스들을 대기상태로 만들어 대기큐에 삽입시킨다음 사용할 수 있는
자원이 생겼을 때 대기 큐에 있는 프로세스를 준비상태로 만듦으로써 사용가능 여부를 확인하고 임계구역에 진입할 수 있도록하여 cpu의 자원을 효율적으로 사용할 수 있다.

세마포를 활용하여 실행순서 동기화 하는 방법은 다음과 같다. A프로세스와 B프로세스가 있을때 A프로세스가 선행되야 한다면 임계구역에 진입할 수 있는 프로세스의 개수를 나타내는 전역변수 s를 0으로 두고 먼저 실행될 A프로세스 뒤에 signal함수를 붙이고,
나중에 실행될 프로세스 앞에 wait 함수를 붙인다.

<br>

## 3. 모니터

<br>

세마포를 사용하여 실행순서를 동기화 하면 프로세스 앞뒤로 wait(), signal() 함수를 매번 호출해야하며, 이는 개발자의 실수라는 변수에서 자유롭지 못하다. 이점을 보완하여 등장한 기법이 바로 모니터 이다.

모니터는 개발자가 다루기 편한 동기화 도구이며 상호배제를 위한 동기화, 실행 순서 제어를 위한 동기화를 모두 제공해주는 동기화 도구이다.

<br>

### 3-1 상호 배제를 위한 동기화

<br>

모니터는 공유자원과 공유자원에 접근할 수 있는 통로를 묶어서 관리하며 공유자원에 접근하려는 프로세스나 스레드는 반드시 특정 인터페이스를 통해서만 접근할 수 있도록 한다. 

프로세스나 스레드는 큐에 저장되어 저장된 순서대로 인터페이스를 통해 공유자원에 접근하여 자원을 이용할 수 있도록 한다.

<br>

### 3-2 실행 순서 제어를 위한 동기화

<br>

모니터는 실행 순서를 위한 동기화를 진행할 때 프로세스나 스레드의 실행 순서를 제어하기 위해 특별한 변수를 사용하는에 이를 
조건변수라 한다.

조건변수.wait() 함수를 호출하여 실행 대기중인 프로세스,스레드를 대기상태로 변경하여 조건변수에 대한 큐에 저장한다.
조건변수.signal() 함수를 호출하여 wait()함수로 인해 대기상태에 있는 조건변수를 실행 상태로 변경한다.

모니터는 특정 프로세스가 아직 실행할 조건이 되지 않았을때에는 wait를 통해 실행을 중단하고, 실행할 조건이 충족되었을때 signal을 통해 실행을 재개한다.

<br>

--- 

<br>

### 참조

<br>

[강의] [개발자를 위한 컴퓨터공학 1: 혼자 공부하는 컴퓨터 구조+운영체제](https://www.inflearn.com/course/%ED%98%BC%EC%9E%90-%EA%B3%B5%EB%B6%80%ED%95%98%EB%8A%94-%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B5%AC%EC%A1%B0-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C)
