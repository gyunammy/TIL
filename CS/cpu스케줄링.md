# CPU 스케줄링 개요

CPU 스케줄링이란 운영체제가 프로세스들에게 공정하고 합리적으로 cpu자원을 배분하는 것을 말한다.

가장 공정한 cpu 스케줄링이란 요청이 들어온 프로세스들을 줄세워 cpu 자원을 배분하는 것과는 거리가있다. 그 이유는 프로세스마다 우선순위라는 것이 있어서 어떤 프로세스는 가능한 빨리 처리되야 하는 반면 어떠한 프로세스는 비교적 급하지않은 요청을 보낼 수도 있기 때문이다.

프로세스의 우선순위는 운영체제가 내부적으로 지정한 것도 있으며 사용자가 우선순위를 지정할 수도 있다.

대개 입출력 작업이 많은 프로세스의 우선순위가 cpu 작업이 많은 프로세스의 우선순위보다 높으며 입출력 작업이 많은 프로세스를 입출력 집중 프로세스, cpu작업이 많은 프로세스를 cpu 집중 프로세스라고 한다.

프로세스가 요구하는 자원, 프로세스의 중요도와 같은 조건을 모두 고려하여  프로세스가 cpu의 자원을 이용할 수 있도록 하기위해 운영체제가 부여하는것이 바로 프로세스 우선순위이다. 우선순위정보는 프로세스의 PCB에 저장된다.

<br>

## 스케줄링 큐

<br>

스케줄링 큐는 다수의 프로세스의 다양한 요청을 효과적으로 정리하여 cpu자원을 배분하기 위해 사용되는 큐이다. 프로세스들의 요청하는 종류에 따라 큐에 저장하여 운영체제는 보다 쉽게 다양한 프로세스의 요청들을 파악할 수 있게 된다.

ex) cpu사용을 요청하는 프로세스, 하드디스크사용을 요청하는 프로세스, 프린터사용을 요청하는 프로세스 ...

스케줄링 큐는 여러 종류로 나뉘며 대표적으로 준비큐와 레디큐가 있다.

준비큐는 cpu를 이용할 준비가 다 되었지만 자신의 차례가 오질않아서 순서를 기다리는 프로세스들이 저장되는 큐이며 대기큐는 cpu를 이용하기 전에 입출력장치를 이용하기 위해 프로레스들이 저장되는 큐를 말한다.

대기큐에 있던 프로세스가 입출력완료되어 인터럽트를 발생시키면 해당 프로세스는 대기큐에서 준비큐로 이동한다.

큐에 저장되어있다 하더라도 저장된 순서대로 자원을 사용하는 것이 아니라 우선순위를 고려하여 순서가 바뀔수도 있다.

<br>

## 선점형과 비선점형 스케줄링

<br>

하나의 프로세스가 cpu자원을 받아 실행하고 있을때 지금 실행중인 프로세스보다 우선순위가 높은 프로세스가 cpu자원을 요청하게 되면 두가지 방법을 따르게 된다.

<br>

### 1. 현재 cpu를 사용중인 프로세스로부터 cpu 자원을 빼앗아 우선순위가 높은 프로세스에 할당한다.

### 2. 현재 cpu를 사용중인 프로세스의 작업이 끝날 때까지 우선순위가 높은 프로세스를 대기시킨다.

<br>

1번과 같은 방법을 선점형 스케줄링이라하며, 2번과 같은 비선점형 스케줄링이라 한다.

선점형 스케줄링은 어느 한 프로세스의 자원 독점을 막고 프로세스들에게 골고루 자원을 배분할 수 있다는 장점이 있으며 그만큼 문맥 교환 과정에서 오버헤드가 발생할수 있다는 단점이 있다.

비선점형 스케줄링은 선점형 스케줄링에 비해 문맥 교환에서 발생하는 오버헤드가 적다는 장점이 있으며 프로세스가 골고루 자원을 이용하기 어렵다는 단점이 있다.

<br>

## cpu 스케줄링 알고리즘

<br>

cpu 스케줄링 알고리즘은 운영체제에 따라 상이하다.

<br>

### 1. 선입 선처리 스케줄링

<br>

선입선처리 스케줄링은 FCFS(First Come First Served) 스케줄링이라고 하며 단순히 준비 큐에 삽입된 순서대로 처리하는 비선점 스케줄링이다. 

선입 선처리 스케줄링은 우선순위가 높은 프로세스임에도 불구하고 대기시간이 매우 길어질 수 있다는 단점이 있고 이를 호위효과라 한다.

<br>

### 2. 최단 작업 우선 스케줄링

<br>

최단 작업 우선 스케줄링은 SJF(Shortest Job First) 스케줄링이라고 하며 cpu사용이 긴 프로세스를 나중에 실행하고, cpu사용시간이 짧은 프로세스를 우선 실행하여 호위효과를 방지한다.

최단 작업 우선 스케줄링은 선점형과 비선점형 모두 구현가능하며 기본적으로 비선점형 스케줄링으로 구현된다.

<br>

### 3. 라운드 로빈 스케줄링

<br>

라운드 로빈 스케줄링은 RR(Round Robin) 스케줄링이라고 하며 각 프로세스가 cpu를 사용할 수 있는 정해진 시간을 의미하는 타임슬라이스 동안 돌아가며 cpu를 이용하는 선점형 스케줄링이다. (선입 선처리 스케줄링 + 타임 슬라이스)

라운드 로빈 스케줄링을 사용했을때 정해진 시간을 모두 사용하였음에도 아직 프로세스가 완료되지 않았다면 다시 큐의 맨 뒤에 삽입된다.

<br>

### 4. 최소 잔여 시간 우선 스케줄링 

<br>

최소 잔여 시간 우선 스케줄링은 SRT(Shortest Remaining Time) 스케줄링이라고 하며 타임슬라이스, 즉 정해진 시간만큼 cpu를 사용하되 다음 cpu를 사용할 프로세스로는 남은 작업 시간이 가장 적은 프로세스를 선택하는 방법이다.

<br>

### 5. 우선순위 스케줄링

<br>

우선순위 스케줄링이란 cpu 사용 요청을 하는 프로세스들에게 우선순위를 부여하고 우선순위가 높은 프로세스부터 실행하는 스케줄링 방법이다. 우선순위가 같은 프로세스들은 선입선처리로 처리된다.

우선순의 스케줄링에는 근본적인 문제가 있는데 바로 기아(starvation)현상이다. 이는 바로 우선순위가 높은 프로세스만을 우선하여 cpu를 사용하기 때문에 우선순위가 낮은 프로세스는 준비큐에 먼저 저장되었음에도 불구하고 실행되지 못하고 실행이 계속 연기되는 현상을 말한다.

이를 해결하는 방법으로는 에이징(aging) 기법이 있다. 대기하고 있는 프로세스의 우선순위를 조금씩 높이는 방식으로, 마치 나이가 먹듯 우선순위가 점차 증가하여 우선순위가 낮은 프로세스가 마냥 기다리는 기아현상을 해소할 수 있다.

<br>

### 6. 다단계 큐 스케줄링

<br>

다단계 큐 스케줄링은 Multilebel queue 스케줄링이라고 하며 우선순위 스케줄링의 발전된 형태이다. 우선순위별로 준비큐를 여러 개를 사용하는 스케줄링 방식으로 우선순위가 가장 높은 큐에 있는 프로세스를 먼저 처리하고, 우선순위가 높은 큐가 비어있다면 그 다음 우선순위가 저장된 큐에 있는 프로세스들을 처리하는 방법이다.

다단계 큐 스케줄링을 사용함으로 얻을 수 있는 장점은 프로세스 유형별로 우선순위를 구분하는것이 쉬워지며 큐마다 스케줄링을 달리하여 별도의 스케줄링을 혼용할 수 있다는 점이 있다.

하지만 큐안에 저장된 프로세스가 다른 큐로 이동이 불가능하기 때문에 특정큐에 기아현상이 나타날 수 있다는 단점이 있다.

<br>

### 7. 다단계 피드백 큐 스케줄링

<br>

다단계 피득백 큐 스케줄링은 Multilebel feedback queue 스케줄링이라고 하며 다단계 큐 스케줄링을 사용하여 특정 큐에 기아현상이 나타날 수 있는 단점을 보완하기 위해 발전된 형태이다.

큐간의 프로세스 이동이 불가능한 다단계 큐 스케줄링과 달리 여러 큐에 저장된 프로세스가 다른 큐로 이동이 가능하기 때문에 기아현상을 해소할 수 있다.

다단계 피드백 큐 스케줄링의 동작은 우선순위가 높은 프로세스가 정해진 타임슬라이스내에 실행을 완료하지 못했다면, 우선순위를 낮추어서 우선순위 낮은 큐에 저장하는 과정을 가진다.

이러한 과정으로 인해 자연스럽게 cpu사용이 많은 프로세스의 우선순위는 상대적으로 점점 낮아지고, 우선순위가 낮았던 프로세스는 상대적으로 우선순위가 높아진다.

또한 에이징기법도 사용할 수 있어서 특정 프로세스가 낮은 우선순위로 인해 실행되지 못하고 있다면 우선순위를 점차 높여 실행되도록 할 수 있다.

다단계 피드백 큐 스케줄링은 복잡하지만 그만큼 현재 대부분의 cpu가 사용중인 스케줄링이다.

<br>

--- 

<br>

### 참조

<br>

[강의] [개발자를 위한 컴퓨터공학 1: 혼자 공부하는 컴퓨터 구조+운영체제](https://www.inflearn.com/course/%ED%98%BC%EC%9E%90-%EA%B3%B5%EB%B6%80%ED%95%98%EB%8A%94-%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B5%AC%EC%A1%B0-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C)
